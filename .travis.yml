---
sudo: required
dist: trusty

language: python
python: "2.7"

env:
  global:
    - secure: YHA2KL1uq/UV02JXD4XWvRt/0Ruu3NJzKjH2n564XAmQeWpXRPcFF0/+MqD0MQq5IDK2nPnmeFhtTDDIT/LLt2Isr8Z0pjggE8vClGWDZiUiPQGOfyCMWbOU2jjQ7Q90tPFWMkIsRuG26cGWP03qxvxKBIDiiCG17oLwTh1fD7o5JDSNneAmvH2ur4aAWI5mR8p6DcNIVB5+EUjg2AeujRxa5glSZKS4eTPjJGhMUTPsZP9VknBa+/l501XdsrqDAXrlTiaYNbQ9g62u63A9A2r8V3VxX+U8rxXTehlCjNFWmx0m8mq7eM+PYivce2jnTExr/fqQ1SpxdNuLYWSjlSjrIZ0yTufb/T1/hEbAuS1dDzQsW9Hhd9cIpGJ0RW3Ib0g5MGHcWe9dC/Oc8N4kzHbmFGCNlM8Pdss6vZcbT4mBU/rUttVEyuPg93bRJDkqH7fuWrwGvxwJYs/4K0ylcSMaCtUohv6l3YV3f+2O+vF+ZNUe13iSNQlotZkgjKuObKPqjaGDFPxZCcb1bzig57uX515/Y+POTfbdfqyag4rg/PNwvaI3e4z/vRcCFaIOS2j/2l4nhejlt+X2BpfU+KSaeJnEfTL5mbipE6yO4gdwt11RCMFl+DvkMIjizI9UR7cW0IuAPrD7x8AWTePQWArPwnG7Z3/BspzRRKsNeZY=
  matrix:
    - ANSIBLE_VERSION=latest
  - ANSIBLE_VERSION=2.9.5
  - ANSIBLE_VERSION=2.9.4
  - ANSIBLE_VERSION=2.9.3
  - ANSIBLE_VERSION=2.9.2
  - ANSIBLE_VERSION=2.9.1
  - ANSIBLE_VERSION=2.9.0
  - ANSIBLE_VERSION=2.8.8
  - ANSIBLE_VERSION=2.8.7
    - ANSIBLE_VERSION=2.8.6
    - ANSIBLE_VERSION=2.8.5
    - ANSIBLE_VERSION=2.8.4
    - ANSIBLE_VERSION=2.8.3
    - ANSIBLE_VERSION=2.8.2
    - ANSIBLE_VERSION=2.8.1
    - ANSIBLE_VERSION=2.8.0
  - ANSIBLE_VERSION=2.7.16
  - ANSIBLE_VERSION=2.7.15
    - ANSIBLE_VERSION=2.7.14
    - ANSIBLE_VERSION=2.7.13
    - ANSIBLE_VERSION=2.7.12
    - ANSIBLE_VERSION=2.7.11
    - ANSIBLE_VERSION=2.7.10
    - ANSIBLE_VERSION=2.7.9
    - ANSIBLE_VERSION=2.7.8
    - ANSIBLE_VERSION=2.7.7
    - ANSIBLE_VERSION=2.7.6
    - ANSIBLE_VERSION=2.7.5
    - ANSIBLE_VERSION=2.7.4
    - ANSIBLE_VERSION=2.7.3
    - ANSIBLE_VERSION=2.7.2
    - ANSIBLE_VERSION=2.7.1
    - ANSIBLE_VERSION=2.7.0
    - ANSIBLE_VERSION=2.6.20
    - ANSIBLE_VERSION=2.6.19
    - ANSIBLE_VERSION=2.6.18
    - ANSIBLE_VERSION=2.6.17
    - ANSIBLE_VERSION=2.6.16
    - ANSIBLE_VERSION=2.6.15
    - ANSIBLE_VERSION=2.6.14
    - ANSIBLE_VERSION=2.6.13
    - ANSIBLE_VERSION=2.6.12
    - ANSIBLE_VERSION=2.6.11
    - ANSIBLE_VERSION=2.6.10
    - ANSIBLE_VERSION=2.6.9
    - ANSIBLE_VERSION=2.6.8
    - ANSIBLE_VERSION=2.6.7
    - ANSIBLE_VERSION=2.6.6
    - ANSIBLE_VERSION=2.6.5
    - ANSIBLE_VERSION=2.6.4
    - ANSIBLE_VERSION=2.6.3
    - ANSIBLE_VERSION=2.6.2
    - ANSIBLE_VERSION=2.6.1
    - ANSIBLE_VERSION=2.6.0
    - ANSIBLE_VERSION=2.5.15
    - ANSIBLE_VERSION=2.5.14
    - ANSIBLE_VERSION=2.5.13
    - ANSIBLE_VERSION=2.5.12
    - ANSIBLE_VERSION=2.5.11
    - ANSIBLE_VERSION=2.5.10
    - ANSIBLE_VERSION=2.5.9
    - ANSIBLE_VERSION=2.5.8
    - ANSIBLE_VERSION=2.5.7
    - ANSIBLE_VERSION=2.5.6
    - ANSIBLE_VERSION=2.5.5
    - ANSIBLE_VERSION=2.5.4
    - ANSIBLE_VERSION=2.5.3
    - ANSIBLE_VERSION=2.5.2
    - ANSIBLE_VERSION=2.5.1
    - ANSIBLE_VERSION=2.5.0

branches:
  only:
    - master

before_install:
  - sudo apt-get update -qq

install:
  # Install Ansible.
  - if [ "$ANSIBLE_VERSION" = "latest" ]; then pip install ansible; else pip install ansible==$ANSIBLE_VERSION; fi
  - if [ "$ANSIBLE_VERSION" = "latest" ]; then pip install ansible-lint; fi

script:
  # Check the role/playbook's syntax.
  - ansible-playbook -i tests/inventory tests/test.yml --syntax-check

  # Run the role/playbook with ansible-playbook.
  - ansible-playbook -i tests/inventory tests/test.yml -vvvv

  # Run the role/playbook again, checking to make sure it's idempotent.
  - >
    ansible-playbook -i tests/inventory tests/test.yml
    | grep -q 'changed=0.*failed=0'
    && (echo 'Idempotence test: pass' && exit 0)
    || (echo 'Idempotence test: fail' && exit 1)

  - if [ "$ANSIBLE_VERSION" = "latest" ]; then ansible-lint tests/test.yml || true; fi

notifications:
  email: false
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    rooms:
      secure: "WplhUfoa+dGJ9juF1X8qSS7EinPAxZRoA8lOoD4g3W2c8hElL9NAPcGFqWI1clNjjKswV7KrHv6EEKiurZ05b7bVnmEFN958L5z5sZEYfF5mG4N40J0/cS/22u1g1AIVkKXegijr3AOgOKZi+b/BqspVDv4d/x7fDraMttaT3Yry5UqkHaFZGyLn+e2GvRBaPxxVTYHPM+OFj9T+y1nOpIuO3j+T0OyORDm2VcGX0zYaeFlUcWFrgWph1xVFUhRvyEtghWOkjg8kxHhlDiR8lm9GbrpT8o47qiq1VqIejhOiMM0fNy2tXgEJcenfgE4uJ3fL7BTJ2HUpb8AcAufLRC+LKLBoocU6MiyMKQcsZHJHM80445tgWALLqjp8oYTCgjYPxxYA9kMKH5f/PCdiztE2LiuZYJRqj/mM7RrxfJAPocDpUzXKrvK/qIXzeKKcsLLyqFmtfEMwKUBYmtNuvTvGzPOfyFKfdIVTkJP6duCzaycSXYv6zI1Fi5k0eijTixO3VchZm2iS8md5+342s269rFUSygW9pidqgG7MTk07VXvvCx8qbFPEIaJYXg7E56jmSPLIFEfSyuJKlODxUj5P/SWh/fmNJaFTQPojk98sCLX1Y9kuIFz6iEMA0mBvZbGMKtp42sr5yqBG0sPPGYXS6pI0JrGEMj4XZOD+5cU="
